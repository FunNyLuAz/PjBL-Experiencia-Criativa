{% extends "template.html" %}

{% import "utils/page_macros.html" as page_macros %}
{% import "utils/form_macros.html" as form_macros %}

{% block title %}
<title>Gerenciador de pagamentos</title>
{% endblock %}

{% block content %}
<div class="container">
    {{ page_macros.flash_verifier() }}

    {{ form_macros.formdivrow_start("payments_manager", col_size="6") }}

        {{ form_macros.title("Gerenciador de pagamentos") }}
        <div class="row my-4">
            <div class="col mx-4">
                {% if usernames_payments|length > 0 %}
                        <ul>
                        {% for username_payment in usernames_payments %}
                            <li>{{ username_payment[0] }}</li>
                            {% if username_payment|length > 0 %}
                                <ul>
                                {% for payment in username_payment[1] %}
                                    <li>
                                        {{ payment.month }},
                                        {{ payment.year }},
                                        {{ payment.is_paid }},
                                        {{ payment.card_num_card}},
                                        {{ payment.card_name_owner }}, 
                                        {{ payment.card_cvv }},
                                        {{ payment.card_month_expire_date }},
                                        {{ payment.card_year_expire_date }}
                                    </li>
                                {% endfor %}
                                </ul>
                            {% else %}
                                <span>Não há pagamentos desse usuário.</span>
                            {% endif %}
                        {% endfor %}
                        </ul>
                {% else %}
                    <span>Não há pagamentos cadastrados no sistema.</span>
                {% endif %}
            </div>
        </div>
        {{ form_macros.br() }}

        {{ form_macros.form_start("form", "add_payment") }}

            {{ form_macros.subtitle("Cadastro de pagamento") }}
            {{ form_macros.select(usernames_options, label="Nome de usuário", placeholder="", id="username", name="username") }}
            {{ form_macros.input("Data do pagamento", id="date", name="date", type="month", extra_params="min=" + current_month_year) }}

            {{ form_macros.button(label='Cadastrar pagamento') }}

            {{ form_macros.br() }}

        {{ form_macros.form_end() }}

    {{ form_macros.formdivrow_end() }}

    {{ page_macros.endlabel("Voltar ao início", "/", is_link=true) }}
</div>
{% endblock %}
